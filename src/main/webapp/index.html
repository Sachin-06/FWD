<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Food Waste Donation Portal</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f3fa; }
    .container { width: 500px; margin: 40px auto; background: #fff;
                 padding: 32px; border-radius: 14px; box-shadow: 0 8px 24px rgba(0,0,0,.12);}
    h2 { margin-bottom: 20px; }
    input, select, button { width: 100%; padding: 11px; margin: 9px 0; border-radius: 5px; border: 1px solid #bbb;}
    button { background: #1980fa; color: #fff; border: none; font-size: 16px;}
    button:hover { background: #155ab6;}
    .msg { margin-top:7px; font-weight: 500; color: #188e36;}
    .error { color: #b90000; }
    .navbtn { margin-bottom: 2px; }
    .dashboard, .form-container { display:none; }
    table {width:100%;border-collapse:collapse;margin:13px 0;background:#f8fafc;}
    th,td{padding:9px;text-align:left;}
    th{background:#deeafb;}
    tr:nth-child(even){background:#f7fbfe;}
  </style>
  <script>
    function showForm(id) {
      document.querySelectorAll('.form-container,.dashboard').forEach(div => div.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }
    function displayMsg(formId, msg, isError=false) {
      const msgEl = document.getElementById(formId + '-msg');
      msgEl.textContent = msg;
      msgEl.className = isError ? 'error msg' : 'msg';
    }
    function submitForm(event, servletUrl, formId) {
      event.preventDefault();
      var form = document.getElementById(formId);
      var formData = new FormData(form);
      fetch(servletUrl, { method: 'POST', body: formData })
        .then(r => r.json())
        .then(json => {
          displayMsg(formId, json.message, json.status !== 'success');
        })
        .catch(() => displayMsg(formId, 'Server error', true));
    }
    function loadDashboard(type) {
      showForm(type+'-dashboard');
      let url, param;
      if (type==='donor') {
        url = 'DonorDashboardServlet';
        param = 'donorid=' + prompt("Enter your User ID for dashboard:");
      } else if (type==='delivery') {
        url = 'DeliveryDashboardServlet';
        param = 'deliveryPersonId=' + prompt("Enter your Delivery User ID:");
      } else {
        url = 'AdminDashboardServlet';
        param=''; // Admin sees all data
      }
      fetch(url+'?'+param)
        .then(resp=> resp.json())
        .then(data => renderDashboard(type, data));
    }
    function renderDashboard(type, data) {
      if(type==='donor') {
        let tbl = "<table><tr><th>ID</th><th>Food</th><th>Qty</th><th>Status</th><th>Pickup</th></tr>";
        if(data.donations && data.donations.length) {
          data.donations.forEach(row=>{
            tbl+=`<tr><td>${row.id}</td><td>${row.foodtype}</td><td>${row.quantity}</td><td>${row.status}</td><td>${row.pickupLocation}</td></tr>`;
          });
        } else {
          tbl+="<tr><td colspan='5'>No donations yet.</td></tr>";
        }
        tbl+="</table>";
        document.getElementById('donor-table').innerHTML = tbl;
      }
      if(type === 'delivery') {
        let tbl = "<table><tr><th>ID</th><th>Donation</th><th>Recipient</th><th>Status</th><th>Confirm?</th></tr>";
        if(data.deliveries && data.deliveries.length) {
          data.deliveries.forEach(row=>{
            tbl+=`<tr><td>${row.id}</td><td>${row.donationId}</td><td>${row.recipientId}</td><td>${row.status}</td><td>${row.confirmationType||''}</td></tr>`;
          });
        } else {
          tbl+="<tr><td colspan='5'>No deliveries assigned.</td></tr>";
        }
        tbl+="</table>";
        document.getElementById('delivery-table').innerHTML = tbl;
      }
      if(type==='admin'){
        let tbl ="<h4>All Donations</h4><table><tr><th>ID</th><th>Food</th><th>Qty</th><th>Status</th><th>Pickup</th><th>Donor</th></tr>";
        if(data.donations && data.donations.length){
            data.donations.forEach(row=>{
              tbl+=`<tr><td>${row.id}</td><td>${row.foodtype}</td><td>${row.quantity}</td><td>${row.status}</td><td>${row.pickupLocation}</td><td>${row.donorid}</td></tr>`;
            });
          }else{
            tbl+="<tr><td colspan='6'>No data.</td></tr>";
          }
        tbl+="</table><h4>All Deliveries</h4><table><tr><th>ID</th><th>Donation</th><th>Delivery</th><th>Recipient</th><th>Status</th></tr>";
        if(data.deliveries && data.deliveries.length){
            data.deliveries.forEach(row=>{
              tbl+=`<tr><td>${row.id}</td><td>${row.donationId}</td><td>${row.deliveryPersonId}</td><td>${row.recipientId}</td><td>${row.status}</td></tr>`;
            });
        }else{
            tbl+="<tr><td colspan='5'>No data.</td></tr>";
        }
        tbl+="</table><h4>All Recipients</h4><table><tr><th>ID</th><th>Name</th><th>Type</th><th>Contact</th><th>Phone</th><th>Address</th></tr>";
        if(data.recipients && data.recipients.length){
            data.recipients.forEach(row=>{
              tbl+=`<tr><td>${row.id}</td><td>${row.name}</td><td>${row.recipientType}</td><td>${row.contactPerson}</td><td>${row.phone}</td><td>${row.address}</td></tr>`;
            });
        }else{
          tbl+="<tr><td colspan='6'>No recipients.</td></tr>";
        }
        tbl+="</table>";
        document.getElementById('admin-table').innerHTML = tbl;
      }
    }
  </script>
</head>
<body>
  <div class="container">
    <h2>Food Waste Donation System</h2>
    <div>
      <button class="navbtn" onclick="showForm('login-form')">Login</button>
      <button class="navbtn" onclick="showForm('register-form')">Register</button>
      <button class="navbtn" onclick="showForm('donor-form')">Donor Submission</button>
      <button class="navbtn" onclick="showForm('assign-form')">Delivery Assignment</button>
      <button class="navbtn" onclick="showForm('recipient-form')">Add Recipient</button>
      <button class="navbtn" onclick="loadDashboard('donor')">Donor Dashboard</button>
      <button class="navbtn" onclick="loadDashboard('delivery')">Delivery Dashboard</button>
      <button class="navbtn" onclick="loadDashboard('admin')">Admin Dashboard</button>
    </div>

    <!-- Forms and Dashboards BELOW: -->
    <!-- Login -->
    <div id="login-form" class="form-container">
      <form id="login-form" onsubmit="submitForm(event, 'LoginServlet', 'login-form')">
        <h3>Login</h3>
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit">Login</button>
      </form>
      <span id="login-form-msg" class="msg"></span>
    </div>
    <!-- Register -->
    <div id="register-form" class="form-container">
      <form id="register-form" onsubmit="submitForm(event, 'RegisterServlet', 'register-form')">
        <h3>Register</h3>
        <input type="text" name="name" placeholder="Name" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <select name="usertype" required>
            <option value="">Role</option>
            <option value="donor">Donor</option>
            <option value="delivery">Delivery Person</option>
            <option value="admin">Admin</option>
        </select>
        <input type="text" name="phone" placeholder="Phone" required>
        <input type="text" name="address" placeholder="Address" required>
        <button type="submit">Register</button>
      </form>
      <span id="register-form-msg" class="msg"></span>
    </div>
    <!-- Donor Submission -->
    <div id="donor-form" class="form-container">
      <form id="donor-form" onsubmit="submitForm(event, 'DonorSubmissionServlet', 'donor-form')">
        <h3>Submit Excess Food (Donor)</h3>
        <input type="number" name="donorid" placeholder="Your User ID" required>
        <input type="text" name="foodtype" placeholder="Food Type" required>
        <input type="text" name="quantity" placeholder="Quantity (e.g. 10kg, 5 boxes)" required>
        <input type="text" name="pickupLocation" placeholder="Pickup Location" required>
        <button type="submit">Submit Donation</button>
      </form>
      <span id="donor-form-msg" class="msg"></span>
    </div>
    <!-- Delivery Assignment -->
    <div id="assign-form" class="form-container">
      <form id="assign-form" onsubmit="submitForm(event, 'DeliveryAssignmentServlet', 'assign-form')">
        <h3>Assign Delivery (Admin)</h3>
        <input type="number" name="donationId" placeholder="Donation ID" required>
        <input type="number" name="deliveryPersonId" placeholder="Delivery Person ID" required>
        <input type="number" name="recipientId" placeholder="Recipient ID" required>
        <button type="submit">Assign Delivery</button>
      </form>
      <span id="assign-form-msg" class="msg"></span>
    </div>
    <!-- Add Recipient -->
    <div id="recipient-form" class="form-container">
      <form id="recipient-form" onsubmit="submitForm(event, 'RecipientServlet', 'recipient-form')">
        <h3>Add Recipient Organization</h3>
        <input type="text" name="name" placeholder="Organization Name" required>
        <input type="text" name="contactPerson" placeholder="Contact Person" required>
        <input type="text" name="phone" placeholder="Phone" required>
        <input type="text" name="address" placeholder="Address" required>
        <select name="recipientType" required>
          <option value="">Type</option>
          <option value="NGO">NGO</option>
          <option value="Old Age Home">Old Age Home</option>
          <option value="Shelter">Shelter</option>
          <option value="Orphanage">Orphanage</option>
          <option value="Other">Other</option>
        </select>
        <button type="submit">Add Recipient</button>
      </form>
      <span id="recipient-form-msg" class="msg"></span>
    </div>

    <!-- Donor Dashboard -->
    <div id="donor-dashboard" class="dashboard">
      <h3>Your Donations</h3>
      <div id="donor-table"></div>
    </div>
    <!-- Delivery Dashboard -->
    <div id="delivery-dashboard" class="dashboard">
      <h3>Your Deliveries</h3>
      <div id="delivery-table"></div>
    </div>
    <!-- Admin Dashboard -->
    <div id="admin-dashboard" class="dashboard">
      <h3>Admin Dashboard – All Data</h3>
      <div id="admin-table"></div>
    </div>
  </div>
</body>
</html>
